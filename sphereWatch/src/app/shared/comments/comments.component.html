
<div class="pt-4">
    <h5>Komentarai</h5>
    <form [formGroup]="addCommentForm"  (ngSubmit)="onCreateComment()">
        <div class="form-group mb-2">
            <textarea formControlName="comment_text" class="form-control" placeholder="sukurkite atsiliepimą"></textarea>
        </div>
        <div class="text-right">
            <button class="btn btn-primary btn-sm" type="submit">Sukurti komentarą</button>
        </div>
    </form>

    <div class="card col-sm" style="width: 30rem;" *ngFor="let comment of CommentsList; let i = index" >
        
        <div *ngIf="!comment.comment_parent_id" class="card-body">
        <h6 class="card-title">{{comment.username}}</h6>
        <h5 class="card-text">{{comment.comment_text}}</h5>
        <p class="card-text">{{comment.created_at}}</p>
        <button *ngIf="showReplyForm === false && showEditForm === false;" class="btn btn-primary btn-xs" (click)="showReplyForm = true; clickedIndex = i">Reply</button>
        <button *ngIf="showEditForm === false && showReplyForm === false;" class="btn btn-primary btn-xs" (click)="showEditForm = true; clickedIndex = i">Edit</button>
        <button class="btn btn-danger btn-xs" (click)="onDeleteComment(comment.id)">Delete</button>
        
        </div>

        <form [formGroup]="addReplyForm" (ngSubmit)="onCreateReply(comment.id)" *ngIf="showReplyForm && !comment.comment_parent_id && clickedIndex === i">
            <div class="form-group mb-2">
                <textarea formControlName="comment_text" class="form-control" ></textarea>
            </div>
            <div class="text-right">
                <button class="btn btn-primary btn-xs" type="submit">Atsakyti</button>
                <button class="btn btn-secondary btn-xs mr-2" type="button" (click)="showReplyForm = false">Atšaukti</button>
            </div>
        </form>

        <form [formGroup]="editCommentForm" (ngSubmit)="onEditComment(comment.id)" *ngIf="showEditForm && !comment.comment_parent_id && clickedIndex === i">
            <div class="form-group mb-2">
                <textarea formControlName="comment_text" class="form-control" [(ngModel)]="comment.comment_text">{{comment.comment_text}}</textarea>
                
            </div>
            <div class="text-right">
                <button class="btn btn-primary btn-xs" type="submit" >Išsaugoti</button>
                <button class="btn btn-secondary btn-xs mr-2" type="button" (click)="showEditForm = false">Atšaukti</button>
            </div>
        </form>

        <!--Child cards-->
        <div *ngFor="let child of CommentsList" >
            <div style="width: 30rem; margin-left: 100px;">
                <div *ngIf="child.comment_parent_id === comment.id" class="card-body">
                <h6 class="card-title">{{child.username}}</h6>
                <h5 class="card-text">{{child.comment_text}}</h5>
                <p class="card-text">{{child.created_at}}</p>
                <button *ngIf="showChildEditForm === false && showReplyForm === false;" class="btn btn-primary btn-xs" (click)="showChildEditForm = true; clickedIndex = child.id">Edit</button>
                <button class="btn btn-danger btn-xs" (click)="onDeleteComment(child.id)">Delete</button>
                
                <form [formGroup]="editCommentForm" (ngSubmit)="onEditComment(child.id)" *ngIf="showChildEditForm && clickedIndex === child.id">
                    <div class="form-group mb-2">
                        <textarea formControlName="comment_text" class="form-control" placeholder="{{child.comment_text}}"></textarea>
                    </div>
                    <div class="text-right">
                        <button class="btn btn-primary btn-xs" type="submit">Išsaugoti</button>
                        <button class="btn btn-secondary btn-xs mr-2" type="button" (click)="showChildEditForm = false">Atšaukti</button>
                    </div>
                </form>
                </div>
                        
            </div>
        </div>

        
    </div>
   
    <div class="text-center">
        <button  class="btn btn-xs btn-pill btn-outline-primary" type="button">Daugiau komentarų</button>
    </div>
</div>
